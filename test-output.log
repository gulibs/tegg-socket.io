
> @gulibs/tegg-socket.io@0.0.3 pretest
> npm run clean && npm run lint -- --fix


> @gulibs/tegg-socket.io@0.0.3 clean
> rimraf dist


> @gulibs/tegg-socket.io@0.0.3 lint
> eslint --cache src test --ext .ts --fix


> @gulibs/tegg-socket.io@0.0.3 test
> egg-bin test



  test/index.test.ts
2025-11-15 03:18:48,712 WARN 29714 [controller.home] plugin config: { namespace: {} }
    âœ” should GET /

  lib/loader
    âœ” collectIoLoadDirs keeps load unit order
    âœ” loadControllersAndMiddleware uses Egg loader APIs and logs directories

  test/socket.io.test.ts
    Basic Socket.IO Functionality
2025-11-15 03:18:49,123 INFO 29968 [master] =================== egg start ðŸ¥šðŸ¥šðŸ¥šðŸ¥š =====================
2025-11-15 03:18:49,123 INFO 29968 [master] node version v23.11.1
2025-11-15 03:18:49,123 INFO 29968 [master] egg version 4.0.10
2025-11-15 03:18:49,123 INFO 29968 [master] start with options: {"baseDir":"/Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/test/fixtures/apps/socket.io-test","port":17001,"startMode":"process","cache":true,"coverage":true,"clean":true,"workers":1,"customEgg":"/Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/node_modules/egg","framework":"/Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/node_modules/egg","plugins":{"egg-mock":{"enable":true,"path":"/Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/node_modules/@eggjs/mock"},"teggSocketIO":{"enable":true,"path":"/Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io"}}}
2025-11-15 03:18:49,123 INFO 29968 [master] start with env: isProduction: false, EGG_SERVER_ENV: undefined, NODE_ENV: test
2025-11-15 03:18:49,130 INFO 29968 [master] agent_worker#1:29997 start with clusterPort:65337
2025-11-15 03:18:50,654 INFO 29968 [master] agent_worker#1:29997 started (1525ms)
2025-11-15 03:18:50,654 INFO 29968 [master] start appWorker with args ["{\"baseDir\":\"/Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/test/fixtures/apps/socket.io-test\",\"port\":17001,\"startMode\":\"process\",\"cache\":true,\"coverage\":true,\"clean\":true,\"workers\":1,\"customEgg\":\"/Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/node_modules/egg\",\"framework\":\"/Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/node_modules/egg\",\"plugins\":{\"egg-mock\":{\"enable\":true,\"path\":\"/Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/node_modules/@eggjs/mock\"},\"teggSocketIO\":{\"enable\":true,\"path\":\"/Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io\"}},\"clusterPort\":65337}"] (process)
2025-11-15 03:18:50,655 INFO 29968 [master] app_worker#1:30071 start, state: none, current workers: ["1"]
2025-11-15 03:18:52,560 INFO 29968 [master] app_worker#1:30071 started at 17001, remain 0 (1906ms)
2025-11-15 03:18:52,561 INFO 29968 [master] egg started on http://127.0.0.1:17001 (3438ms)
2025-11-15 03:18:52,577 ERROR 30071 nodejs.TypeError: Cannot read properties of undefined (reading 'call') (uncaughtException throw 1 times on pid: 30071)
    at Socket.<anonymous> (file:///Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/src/boot.ts:176:53)
    at Socket.emit (node:events:507:28)
    at Socket.emit (node:domain:489:12)
    at Socket.emitUntyped (/Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/node_modules/socket.io/dist/typed-events.js:69:22)
    at /Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/node_modules/socket.io/dist/socket.js:697:39
    at processTicksAndRejections (node:internal/process/task_queues:85:11)

pid: 30071
hostname: gujiwendeMacBook-Pro.local

[Sat Nov 15 2025 03:18:52 GMT+0800 (China Standard Time)] [graceful:worker:30071:uncaughtException] throw error 1 times
TypeError: Cannot read properties of undefined (reading 'call') (uncaughtException throw 1 times on pid: 30071)
    at Socket.<anonymous> (file:///Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/src/boot.ts:176:53)
    at Socket.emit (node:events:507:28)
    at Socket.emit (node:domain:489:12)
    at Socket.emitUntyped (/Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/node_modules/socket.io/dist/typed-events.js:69:22)
    at /Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/node_modules/socket.io/dist/socket.js:697:39
    at processTicksAndRejections (node:internal/process/task_queues:85:11)
TypeError: Cannot read properties of undefined (reading 'call') (uncaughtException throw 1 times on pid: 30071)
    at Socket.<anonymous> (file:///Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/src/boot.ts:176:53)
    at Socket.emit (node:events:507:28)
    at Socket.emit (node:domain:489:12)
    at Socket.emitUntyped (/Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/node_modules/socket.io/dist/typed-events.js:69:22)
    at /Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/node_modules/socket.io/dist/socket.js:697:39
    at processTicksAndRejections (node:internal/process/task_queues:85:11)
[Sat Nov 15 2025 03:18:52 GMT+0800 (China Standard Time)] [graceful:worker:30071] will exit after 30000ms
[Sat Nov 15 2025 03:18:52 GMT+0800 (China Standard Time)] [graceful:worker:30071] close server#0, connections: undefined
[Sat Nov 15 2025 03:18:52 GMT+0800 (China Standard Time)] [graceful:worker:30071] close 1 servers!
[Sat Nov 15 2025 03:18:52 GMT+0800 (China Standard Time)] [graceful:worker:30071] worker disconnect!
[2025-11-15 03:18:52.578] [cfork:master:29968] worker:30071 disconnect (exitedAfterDisconnect: true, state: disconnected, isDead: false, worker.disableRefork: false, isSlave: false, slaveIndex: )
[2025-11-15 03:18:52.578] [cfork:master:29968] don't fork new work (refork: false, reforkCount: 0)
2025-11-15 03:18:52,578 INFO 29968 [master] app_worker#1:30071 disconnect, suicide: true, state: disconnected, current workers: ["1"]
[Sat Nov 15 2025 03:19:22 GMT+0800 (China Standard Time)] [graceful:worker:30071] kill timeout, exit now. NODE_ENV: test
      1) should single worker works ok
