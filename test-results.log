
> @gulibs/tegg-socket.io@0.0.3 pretest
> npm run clean && npm run lint -- --fix


> @gulibs/tegg-socket.io@0.0.3 clean
> rimraf dist


> @gulibs/tegg-socket.io@0.0.3 lint
> eslint --cache src test --ext .ts --fix


> @gulibs/tegg-socket.io@0.0.3 test
> egg-bin test



  test/index.test.ts
2025-11-15 03:20:57,282 WARN 37482 [controller.home] plugin config: { namespace: {} }
    âœ” should GET /

  lib/loader
    âœ” collectIoLoadDirs keeps load unit order
    âœ” loadControllersAndMiddleware uses Egg loader APIs and logs directories

  test/socket.io.test.ts
    Basic Socket.IO Functionality
2025-11-15 03:20:57,789 INFO 37617 [master] =================== egg start ðŸ¥šðŸ¥šðŸ¥šðŸ¥š =====================
2025-11-15 03:20:57,789 INFO 37617 [master] node version v23.11.1
2025-11-15 03:20:57,789 INFO 37617 [master] egg version 4.0.10
2025-11-15 03:20:57,789 INFO 37617 [master] start with options: {"baseDir":"/Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/test/fixtures/apps/socket.io-test","port":17001,"startMode":"process","cache":true,"coverage":true,"clean":true,"workers":1,"customEgg":"/Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/node_modules/egg","framework":"/Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/node_modules/egg","plugins":{"egg-mock":{"enable":true,"path":"/Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/node_modules/@eggjs/mock"},"teggSocketIO":{"enable":true,"path":"/Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io"}}}
2025-11-15 03:20:57,789 INFO 37617 [master] start with env: isProduction: false, EGG_SERVER_ENV: undefined, NODE_ENV: test
2025-11-15 03:20:57,797 INFO 37617 [master] agent_worker#1:37652 start with clusterPort:65480
2025-11-15 03:20:59,677 INFO 37617 [master] agent_worker#1:37652 started (1881ms)
2025-11-15 03:20:59,677 INFO 37617 [master] start appWorker with args ["{\"baseDir\":\"/Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/test/fixtures/apps/socket.io-test\",\"port\":17001,\"startMode\":\"process\",\"cache\":true,\"coverage\":true,\"clean\":true,\"workers\":1,\"customEgg\":\"/Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/node_modules/egg\",\"framework\":\"/Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/node_modules/egg\",\"plugins\":{\"egg-mock\":{\"enable\":true,\"path\":\"/Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/node_modules/@eggjs/mock\"},\"teggSocketIO\":{\"enable\":true,\"path\":\"/Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io\"}},\"clusterPort\":65480}"] (process)
2025-11-15 03:20:59,679 INFO 37617 [master] app_worker#1:37753 start, state: none, current workers: ["1"]
2025-11-15 03:21:01,971 INFO 37617 [master] app_worker#1:37753 started at 17001, remain 0 (2294ms)
2025-11-15 03:21:01,971 INFO 37617 [master] egg started on http://127.0.0.1:17001 (4182ms)
2025-11-15 03:21:01,987 ERROR 37753 nodejs.TypeError: Cannot read properties of undefined (reading 'call') (uncaughtException throw 1 times on pid: 37753)
    at Socket.<anonymous> (file:///Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/src/boot.ts:176:53)
    at Socket.emit (node:events:507:28)
    at Socket.emit (node:domain:489:12)
    at Socket.emitUntyped (/Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/node_modules/socket.io/dist/typed-events.js:69:22)
    at /Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/node_modules/socket.io/dist/socket.js:697:39
    at processTicksAndRejections (node:internal/process/task_queues:85:11)

pid: 37753
hostname: gujiwendeMacBook-Pro.local

[Sat Nov 15 2025 03:21:01 GMT+0800 (China Standard Time)] [graceful:worker:37753:uncaughtException] throw error 1 times
TypeError: Cannot read properties of undefined (reading 'call') (uncaughtException throw 1 times on pid: 37753)
    at Socket.<anonymous> (file:///Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/src/boot.ts:176:53)
    at Socket.emit (node:events:507:28)
    at Socket.emit (node:domain:489:12)
    at Socket.emitUntyped (/Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/node_modules/socket.io/dist/typed-events.js:69:22)
    at /Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/node_modules/socket.io/dist/socket.js:697:39
    at processTicksAndRejections (node:internal/process/task_queues:85:11)
TypeError: Cannot read properties of undefined (reading 'call') (uncaughtException throw 1 times on pid: 37753)
    at Socket.<anonymous> (file:///Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/src/boot.ts:176:53)
    at Socket.emit (node:events:507:28)
    at Socket.emit (node:domain:489:12)
    at Socket.emitUntyped (/Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/node_modules/socket.io/dist/typed-events.js:69:22)
    at /Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/node_modules/socket.io/dist/socket.js:697:39
    at processTicksAndRejections (node:internal/process/task_queues:85:11)
[Sat Nov 15 2025 03:21:01 GMT+0800 (China Standard Time)] [graceful:worker:37753] will exit after 30000ms
[Sat Nov 15 2025 03:21:01 GMT+0800 (China Standard Time)] [graceful:worker:37753] close server#0, connections: undefined
[Sat Nov 15 2025 03:21:01 GMT+0800 (China Standard Time)] [graceful:worker:37753] close 1 servers!
[Sat Nov 15 2025 03:21:01 GMT+0800 (China Standard Time)] [graceful:worker:37753] worker disconnect!
[2025-11-15 03:21:01.988] [cfork:master:37617] worker:37753 disconnect (exitedAfterDisconnect: true, state: disconnected, isDead: false, worker.disableRefork: false, isSlave: false, slaveIndex: )
[2025-11-15 03:21:01.988] [cfork:master:37617] don't fork new work (refork: false, reforkCount: 0)
2025-11-15 03:21:01,988 INFO 37617 [master] app_worker#1:37753 disconnect, suicide: true, state: disconnected, current workers: ["1"]
[Sat Nov 15 2025 03:21:31 GMT+0800 (China Standard Time)] [graceful:worker:37753] kill timeout, exit now. NODE_ENV: test
      1) should single worker works ok
      2) should multi process works ok with sticky mode
      âœ” should app.io be accessible (149ms)
      âœ” should app.io be initialized with serveClient(false) (160ms)
    Controller System
2025-11-15 03:22:59,475 INFO 44868 [master] =================== egg start ðŸ¥šðŸ¥šðŸ¥šðŸ¥š =====================
2025-11-15 03:22:59,475 INFO 44868 [master] node version v23.11.1
2025-11-15 03:22:59,475 INFO 44868 [master] egg version 4.0.10
2025-11-15 03:22:59,476 INFO 44868 [master] start with options: {"baseDir":"/Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/test/fixtures/apps/socket.io-controller-class","port":17002,"startMode":"process","cache":true,"coverage":true,"clean":true,"workers":1,"customEgg":"/Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/node_modules/egg","framework":"/Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/node_modules/egg","plugins":{"egg-mock":{"enable":true,"path":"/Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/node_modules/@eggjs/mock"},"teggSocketIO":{"enable":true,"path":"/Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io"}}}
2025-11-15 03:22:59,476 INFO 44868 [master] start with env: isProduction: false, EGG_SERVER_ENV: undefined, NODE_ENV: test
2025-11-15 03:22:59,483 INFO 44868 [master] agent_worker#1:44935 start with clusterPort:49355
2025-11-15 03:23:00,887 ERROR 44935 nodejs.Error: [@eggjs/core] load file: /Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/src/config/config.default.ts, error: Cannot require() ES Module /Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/src/config/config.default.ts in a cycle.A cycle involving require(esm) is disallowed to maintain invariants madated by the ECMAScript specificationTry making at least part of the dependency in the graph lazily loaded.
    at Object.loadFile (file:///Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/node_modules/@eggjs/core/src/utils/index.ts:97:19)
    at async AgentWorkerLoader.requireFile (file:///Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/node_modules/@eggjs/core/src/loader/egg_loader.ts:1678:17)
    at async AgentWorkerLoader.loadFile (file:///Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/node_modules/@eggjs/core/src/loader/egg_loader.ts:1660:15)
    at async AgentWorkerLoader.#loadConfig (file:///Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/node_modules/@eggjs/core/src/loader/egg_loader.ts:1017:41)
    at async AgentWorkerLoader.loadConfig (file:///Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/node_modules/@eggjs/core/src/loader/egg_loader.ts:944:24)
    at async AgentWorkerLoader.loadConfig (file:///Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/node_modules/egg/src/lib/loader/AgentWorkerLoader.ts:13:5)
    at async Agent.loadConfig (file:///Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/node_modules/egg/src/lib/egg.ts:191:5)
    at async Agent.load (file:///Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/node_modules/egg/src/lib/egg.ts:195:5)
    at async file:///Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/node_modules/egg/src/lib/egg.ts:179:7
    at async file:///Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/node_modules/@eggjs/core/src/lifecycle.ts:423:9
cause: {"code":"ERR_REQUIRE_CYCLE_MODULE"}
cause:

nodejs.ERR_REQUIRE_CYCLE_MODULEError: Cannot require() ES Module /Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/src/config/config.default.ts in a cycle.A cycle involving require(esm) is disallowed to maintain invariants madated by the ECMAScript specificationTry making at least part of the dependency in the graph lazily loaded.
    at ModuleLoader.importSyncForRequire (node:internal/modules/esm/loader:414:13)
    at loadESMFromCJS (node:internal/modules/cjs/loader:1565:24)
    at Module._compile (node:internal/modules/cjs/loader:1716:5)
    at Module.m._compile (/Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/node_modules/ts-node/src/index.ts:1618:23)
    at loadTS (node:internal/modules/cjs/loader:1826:10)
    at Object.require.extensions.<computed> [as .ts] (/Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/node_modules/ts-node/src/index.ts:1621:12)
    at Module.load (node:internal/modules/cjs/loader:1469:32)
    at Function._load (node:internal/modules/cjs/loader:1286:12)
    at TracingChannel.traceSync (node:diagnostics_channel:322:14)
    at wrapModuleLoad (node:internal/modules/cjs/loader:235:24)
code: "ERR_REQUIRE_CYCLE_MODULE"
pid: 44935
hostname: gujiwendeMacBook-Pro.local

2025-11-15 03:23:00,887 ERROR 44935 [agent_worker] start error, exiting with code:1
2025-11-15 03:23:00,906 ERROR 44868 nodejs.AgentWorkerDiedError: [master] agent_worker#1:44935 died (code: 0, signal: null)
    at Master.onAgentExit (file:///Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/node_modules/@eggjs/cluster/src/master.ts:338:17)
    at Master.emit (node:events:507:28)
    at Master.emit (node:domain:489:12)
    at Messenger.sendToMaster (file:///Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/node_modules/@eggjs/cluster/src/utils/messenger.ts:165:18)
    at Messenger.send (file:///Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/node_modules/@eggjs/cluster/src/utils/messenger.ts:129:12)
    at ChildProcess.<anonymous> (file:///Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/node_modules/@eggjs/cluster/src/utils/mode/impl/process/agent.ts:94:22)
    at Object.onceWrapper (node:events:622:26)
    at ChildProcess.emit (node:events:507:28)
    at ChildProcess.emit (node:domain:489:12)
    at Process.ChildProcess._handle.onexit (node:internal/child_process:294:12)
name: "AgentWorkerDiedError"
pid: 44868
hostname: gujiwendeMacBook-Pro.local

2025-11-15 03:23:00,906 ERROR 44868 [master] agent_worker#1:44935 start fail, exiting with code:1
2025-11-15 03:23:00,906 ERROR 44868 [master] exit with code:1
      3) should controller class works ok
2025-11-15 03:23:59,968 INFO 48414 [master] =================== egg start ðŸ¥šðŸ¥šðŸ¥šðŸ¥š =====================
2025-11-15 03:23:59,968 INFO 48414 [master] node version v23.11.1
2025-11-15 03:23:59,968 INFO 48414 [master] egg version 4.0.10
2025-11-15 03:23:59,968 INFO 48414 [master] start with options: {"baseDir":"/Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/test/fixtures/apps/socket.io-controller-async","port":17003,"startMode":"process","cache":true,"coverage":true,"clean":true,"workers":1,"customEgg":"/Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/node_modules/egg","framework":"/Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/node_modules/egg","plugins":{"egg-mock":{"enable":true,"path":"/Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/node_modules/@eggjs/mock"},"teggSocketIO":{"enable":true,"path":"/Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io"}}}
2025-11-15 03:23:59,968 INFO 48414 [master] start with env: isProduction: false, EGG_SERVER_ENV: undefined, NODE_ENV: test
2025-11-15 03:23:59,975 INFO 48414 [master] agent_worker#1:48415 start with clusterPort:49428
2025-11-15 03:24:01,152 INFO 48414 [master] agent_worker#1:48415 started (1178ms)
2025-11-15 03:24:01,152 INFO 48414 [master] start appWorker with args ["{\"baseDir\":\"/Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/test/fixtures/apps/socket.io-controller-async\",\"port\":17003,\"startMode\":\"process\",\"cache\":true,\"coverage\":true,\"clean\":true,\"workers\":1,\"customEgg\":\"/Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/node_modules/egg\",\"framework\":\"/Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/node_modules/egg\",\"plugins\":{\"egg-mock\":{\"enable\":true,\"path\":\"/Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/node_modules/@eggjs/mock\"},\"teggSocketIO\":{\"enable\":true,\"path\":\"/Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io\"}},\"clusterPort\":49428}"] (process)
2025-11-15 03:24:01,154 INFO 48414 [master] app_worker#1:48512 start, state: none, current workers: ["1"]
2025-11-15 03:24:02,489 ERROR 48512 nodejs.TypeError: Cannot read properties of undefined (reading 'ping')
    at exports.default (/Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/test/fixtures/apps/socket.io-controller-async/app/router.ts:9:51)
    at AppWorkerLoader.loadFile (file:///Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/node_modules/@eggjs/core/src/loader/egg_loader.ts:1662:13)
    at async AppWorkerLoader.loadRouter (file:///Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/node_modules/@eggjs/core/src/loader/egg_loader.ts:1564:5)
    at async AppWorkerLoader.load (file:///Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/node_modules/egg/src/lib/loader/AppWorkerLoader.ts:40:5)
    at async Application.load (file:///Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/node_modules/egg/src/lib/egg.ts:234:5)
    at async Application.load (file:///Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/node_modules/egg/src/lib/application.ts:67:5)
    at async file:///Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/node_modules/egg/src/lib/egg.ts:179:7
    at async file:///Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/node_modules/@eggjs/core/src/lifecycle.ts:423:9

pid: 48512
hostname: gujiwendeMacBook-Pro.local

2025-11-15 03:24:02,489 ERROR 48512 nodejs.TypeError: Cannot read properties of undefined (reading 'ping')
    at exports.default (/Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/test/fixtures/apps/socket.io-controller-async/app/router.ts:9:51)
    at AppWorkerLoader.loadFile (file:///Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/node_modules/@eggjs/core/src/loader/egg_loader.ts:1662:13)
    at async AppWorkerLoader.loadRouter (file:///Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/node_modules/@eggjs/core/src/loader/egg_loader.ts:1564:5)
    at async AppWorkerLoader.load (file:///Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/node_modules/egg/src/lib/loader/AppWorkerLoader.ts:40:5)
    at async Application.load (file:///Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/node_modules/egg/src/lib/egg.ts:234:5)
    at async Application.load (file:///Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/node_modules/egg/src/lib/application.ts:67:5)
    at async file:///Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/node_modules/egg/src/lib/egg.ts:179:7
    at async file:///Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/node_modules/@eggjs/core/src/lifecycle.ts:423:9

pid: 48512
hostname: gujiwendeMacBook-Pro.local

2025-11-15 03:24:02,489 ERROR 48512 [app_worker] start error, exiting with code:1
[2025-11-15 03:24:02.504] [cfork:master:48414] worker:48512 disconnect (exitedAfterDisconnect: false, state: disconnected, isDead: false, worker.disableRefork: true, isSlave: false, slaveIndex: )
[2025-11-15 03:24:02.504] [cfork:master:48414] don't fork, because worker:48512 will be kill soon
2025-11-15 03:24:02,504 INFO 48414 [master] app_worker#1:48512 disconnect, suicide: false, state: disconnected, current workers: ["1"]
[2025-11-15 03:24:02.504] [cfork:master:48414] worker:48512 exit (code: 0, exitedAfterDisconnect: false, state: dead, isDead: true, isExpected: false, worker.disableRefork: true, isSlave: false, slaveIndex: )
2025-11-15 03:24:02,508 ERROR 48414 nodejs.AppWorkerDiedError: [master] app_worker#1:48512 died (code: 0, signal: null, suicide: false, state: dead), current workers: [48512]
    at Master.onAppExit (file:///Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/node_modules/@eggjs/cluster/src/master.ts:423:21)
    at Master.emit (node:events:507:28)
    at Master.emit (node:domain:489:12)
    at Messenger.sendToMaster (file:///Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/node_modules/@eggjs/cluster/src/utils/messenger.ts:165:18)
    at Messenger.send (file:///Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/node_modules/@eggjs/cluster/src/utils/messenger.ts:129:12)
    at EventEmitter.<anonymous> (file:///Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/node_modules/@eggjs/cluster/src/utils/mode/impl/process/app.ts:119:22)
    at EventEmitter.emit (node:events:519:35)
    at EventEmitter.emit (node:domain:489:12)
    at ChildProcess.<anonymous> (node:internal/cluster/primary:188:13)
    at Object.onceWrapper (node:events:622:26)
name: "AppWorkerDiedError"
pid: 48414
hostname: gujiwendeMacBook-Pro.local

2025-11-15 03:24:02,508 ERROR 48414 [master] app_worker#1:48512 start fail, exiting with code:1
2025-11-15 03:24:02,508 ERROR 48414 [master] exit with code:1
2025-11-15 03:24:02,516 ERROR 48415 [agent_worker] receive disconnect event on child_process fork mode, exiting with code:110
2025-11-15 03:24:02,516 ERROR 48415 [agent_worker] exit with code:110
      4) should async/await works ok
    Namespace Management
2025-11-15 03:25:00,778 INFO 51801 [master] =================== egg start ðŸ¥šðŸ¥šðŸ¥šðŸ¥š =====================
2025-11-15 03:25:00,779 INFO 51801 [master] node version v23.11.1
2025-11-15 03:25:00,779 INFO 51801 [master] egg version 4.0.10
2025-11-15 03:25:00,779 INFO 51801 [master] start with options: {"baseDir":"/Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/test/fixtures/apps/socket.io-namespace","port":17004,"startMode":"process","cache":true,"coverage":true,"clean":true,"workers":1,"customEgg":"/Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/node_modules/egg","framework":"/Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/node_modules/egg","plugins":{"egg-mock":{"enable":true,"path":"/Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/node_modules/@eggjs/mock"},"teggSocketIO":{"enable":true,"path":"/Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io"}}}
2025-11-15 03:25:00,779 INFO 51801 [master] start with env: isProduction: false, EGG_SERVER_ENV: undefined, NODE_ENV: test
2025-11-15 03:25:00,786 INFO 51801 [master] agent_worker#1:51836 start with clusterPort:49488
2025-11-15 03:25:01,887 INFO 51801 [master] agent_worker#1:51836 started (1102ms)
2025-11-15 03:25:01,887 INFO 51801 [master] start appWorker with args ["{\"baseDir\":\"/Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/test/fixtures/apps/socket.io-namespace\",\"port\":17004,\"startMode\":\"process\",\"cache\":true,\"coverage\":true,\"clean\":true,\"workers\":1,\"customEgg\":\"/Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/node_modules/egg\",\"framework\":\"/Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/node_modules/egg\",\"plugins\":{\"egg-mock\":{\"enable\":true,\"path\":\"/Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/node_modules/@eggjs/mock\"},\"teggSocketIO\":{\"enable\":true,\"path\":\"/Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io\"}},\"clusterPort\":49488}"] (process)
2025-11-15 03:25:01,888 INFO 51801 [master] app_worker#1:51899 start, state: none, current workers: ["1"]
2025-11-15 03:25:03,180 INFO 51801 [master] app_worker#1:51899 started at 17004, remain 0 (1293ms)
2025-11-15 03:25:03,180 INFO 51801 [master] egg started on http://127.0.0.1:17004 (2401ms)
      5) should namespace works ok
2025-11-15 03:26:01,526 INFO 51801 [master] master is killed by signal SIGTERM, closing
2025-11-15 03:26:01,527 INFO 51801 [master] system memory: total 19327352832, free 242892800
2025-11-15 03:26:01,527 INFO 51801 [master] process info: heap_limit 4345298944, heap_used 38361968
2025-11-15 03:26:01,527 INFO 51801 [master] send kill SIGTERM to app workers, will exit with code:0 after 5000ms
2025-11-15 03:26:01,527 INFO 51801 [master] wait 5000ms
2025-11-15 03:26:01,527 INFO 37617 [master] master is killed by signal SIGTERM, closing
2025-11-15 03:26:01,528 INFO 37617 [master] system memory: total 19327352832, free 235585536
2025-11-15 03:26:01,528 INFO 37617 [master] process info: heap_limit 4345298944, heap_used 38375952
2025-11-15 03:26:01,528 INFO 37617 [master] send kill SIGTERM to app workers, will exit with code:0 after 5000ms
2025-11-15 03:26:01,528 INFO 37617 [master] wait 5000ms
[2025-11-15 03:26:01.692] [cfork:master:51801] worker:51899 disconnect (exitedAfterDisconnect: false, state: disconnected, isDead: false, worker.disableRefork: true, isSlave: false, slaveIndex: )
[2025-11-15 03:26:01.692] [cfork:master:51801] don't fork, because worker:51899 will be kill soon
2025-11-15 03:26:01,693 INFO 51801 [master] app_worker#1:51899 disconnect, suicide: false, state: disconnected, current workers: ["1"]
[2025-11-15 03:26:01.693] [cfork:master:51801] worker:51899 exit (code: 0, exitedAfterDisconnect: false, state: dead, isDead: true, isExpected: false, worker.disableRefork: true, isSlave: false, slaveIndex: )
2025-11-15 03:26:01,693 INFO 51801 [master] send kill SIGTERM to agent worker, will exit with code:0 after 5000ms
2025-11-15 03:26:01,693 INFO 51801 [master] wait 5000ms
2025-11-15 03:26:01,693 INFO 51801 [master] kill agent worker with signal SIGTERM
[2025-11-15 03:26:01.768] [cfork:master:37617] worker:37753 exit (code: 0, exitedAfterDisconnect: true, state: dead, isDead: true, isExpected: true, worker.disableRefork: true, isSlave: false, slaveIndex: )
2025-11-15 03:26:01,768 INFO 37617 [master] send kill SIGTERM to agent worker, will exit with code:0 after 5000ms
2025-11-15 03:26:01,768 INFO 37617 [master] wait 5000ms
2025-11-15 03:26:01,768 INFO 37617 [master] kill agent worker with signal SIGTERM
2025-11-15 03:26:01,831 INFO 51801 [master] close done, exiting with code:0
2025-11-15 03:26:01,831 INFO 51801 [master] exit with code:0
2025-11-15 03:26:01,918 INFO 37617 [master] close done, exiting with code:0
2025-11-15 03:26:01,918 INFO 37617 [master] exit with code:0

  ts-helper integration
    âœ” generates CustomController and CustomMiddleware declarations (362ms)


  6 passing (5m)
  5 failing

  1) test/socket.io.test.ts
       Basic Socket.IO Functionality
         should single worker works ok:
     Error: Timeout of 60000ms exceeded. For async tests and hooks, ensure "done()" is called; if returning a Promise, ensure it resolves. (/Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/test/socket.io.test.ts)
      at listOnTimeout (node:internal/timers:608:17)
      at processTimers (node:internal/timers:543:7)

  2) test/socket.io.test.ts
       Basic Socket.IO Functionality
         should multi process works ok with sticky mode:
     Error: Timeout of 60000ms exceeded. For async tests and hooks, ensure "done()" is called; if returning a Promise, ensure it resolves. (/Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/test/socket.io.test.ts)
      at listOnTimeout (node:internal/timers:608:17)
      at processTimers (node:internal/timers:543:7)

  3) test/socket.io.test.ts
       Controller System
         should controller class works ok:
     Error: Timeout of 60000ms exceeded. For async tests and hooks, ensure "done()" is called; if returning a Promise, ensure it resolves. (/Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/test/socket.io.test.ts)
      at listOnTimeout (node:internal/timers:608:17)
      at processTimers (node:internal/timers:543:7)

  4) test/socket.io.test.ts
       Controller System
         should async/await works ok:
     Error: Timeout of 60000ms exceeded. For async tests and hooks, ensure "done()" is called; if returning a Promise, ensure it resolves. (/Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/test/socket.io.test.ts)
      at listOnTimeout (node:internal/timers:608:17)
      at processTimers (node:internal/timers:543:7)

  5) test/socket.io.test.ts
       Namespace Management
         should namespace works ok:
     Error: Timeout of 60000ms exceeded. For async tests and hooks, ensure "done()" is called; if returning a Promise, ensure it resolves. (/Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/test/socket.io.test.ts)
      at listOnTimeout (node:internal/timers:608:17)
      at processTimers (node:internal/timers:543:7)



[mochawesome] Report JSON saved to /Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/node_modules/.mochawesome-reports/mochawesome.json

[mochawesome] Report HTML saved to /Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-socket.io/node_modules/.mochawesome-reports/mochawesome.html

    Error: /Users/wormhole/Documents/Developments/Our/librarys/@gulibs/tegg-so
    cket.io/node_modules/mocha/bin/_mocha --exit --timeout=60000 
    --reporter=/Users/wormhole/Documents/Developments/Our/librarys/@gulibs/teg
    g-socket.io/node_modules/mochawesome-with-mocha/src/mochawesome.js 
    --reporter-options=reportDir=node_modules/.mochawesome-reports 
    test/index.test.ts test/lib/loader.test.ts test/socket.io.test.ts 
    test/ts-helper.test.ts exit with code 1
    Code: 1
